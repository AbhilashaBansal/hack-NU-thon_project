<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Covid Helper</title>
  <link rel='icon'
    href='https://khn.org/wp-content/uploads/sites/2/2020/05/GettyImages-1216013837.jpg?w=1024' type='image/gif' />
    
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js" integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.1/dist/umd/popper.min.js" integrity="sha384-SR1sx49pcuLnqZUnnPwx6FCym0wLsk5JZuNx2bPPENzswTNFaQU1RDvt3wT4gWFG" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.min.js" integrity="sha384-j0CNLUeiqtyaRmlzUHCPZ+Gy5fQu0dQ6eZ/xAww941Ai1SxSY+0EQqNXNE6DZiVc" crossorigin="anonymous"></script>
      
  <link href="./css/style.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Indie+Flower&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Josefin+Sans:wght@500&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Arvo&family=Cairo&family=EB+Garamond:wght@700&family=Kalam&family=Special+Elite&family=Sriracha&display=swap" rel="stylesheet">
</head>

<body>
    <nav class="navbar navbar-dark navbar-expand-sm fixed-top">
        <div class="container">
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#Navbar">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="navbar-brand mr-auto logo" href="#"><img src="./image/logo.jpeg" height="40" width="60"></div>           
            <div class=" navbar-collapse text-center" id="Navbar">
                <ul class="navbar-nav mr-auto justify-content-center ">
                    <li class="nav-item "><a class="nav-link" href="./"><span class="fa fa-home fa-lg"></span> Home</a></li>
                    <li class="nav-item "><a class="nav-link" href="./covidstats.html"><span class="fa  fa-info fa-lg"></span> COVID Stats</a></li>
                    <li class="nav-item "><a class="nav-link" href="#help"><span class="fa fa-phone-square fa-lg"></span> Helpline</a></li>
                    <li class="nav-item active"><a class="nav-link" href="./forum.html"><span class="fa fa-phone-square fa-lg"></span> Forum</a></li>
                </ul>
                
                <span class="navbar-text">
                    <button type="button" style="color: white; background: none; border: none;" id="admin-login">
                    <span class="fa fa-sign-in"></span> Admin Login</button>
                </span>
                <div class="navbar-brand ml-4 mr-0 " href="#"><img class="img1" src="image/img2.png" height="60" width="60"></div>
            </div>
                    
        </div>
    </nav>
    <br><br><br><br>
    <div id="admin-login-div" class="container">
      <form action="/admin_login/" method="POST" name="admin-form">
        <div class="form-group">
        <label for="email">Email: </label>
        <input type="email" class="form-control" id="admin_email" name="email" placeholder="enter admin email">
        </div>
        <div class="form-group">
            <label for="pass">Password: </label>
            <input type="password" class="form-control" id="admin_pass" name="pass" placeholder="enter admin password">
        </div>
        <button type="submit" class="btn btn-primary" formaction="/admin_login" formmethod="POST">Login</button>
      </form>
    </div>
    
    <br> <br>

    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-6">
                <button class="btn btn-primary" id="btn1">Ask a Question</button>
                <br><br>
                <div id="question-box">
                    <form action="/add_question" method="POST" name="add_question" id="add_ques_form">
                        <div class="form-group">
                            <label for="question">Question: </label>
                            <input type="text" class="form-control" id="question" name="question">
                        </div>
                        
                        <button type="button" class="btn btn-primary" id="add-ques-btn" formaction="/add_question" formmethod="POST">submit</button>
                    </form>
                </div>
                <br><br>
            </div>
        </div>
        <div class="row justify-content-center">
            <div class="col-md-6">
            <ul id="que-cards">

            </ul>
            </div>
        </div>
        <br><br>
    </div>
        
    <section id="help" class="container shadow p-5">
      <h2 class="nav-font" style="color:#1b6ca8;text-align:center"><b>Helpline Details</b></h2>
  
      <br> <br>
  
      <div class="container text-center">
  
        <div class="row">
          <div class="col-lg-4">
  
  
            <div class="card mx-auto" style="width: 18rem; border: 3px solid #1b6ca8">
  
              <div class="card-body">
                <h5 class="card-title">Helpline Number</h5>
                <h6 class="text-center"><span><a href="tel:+91-11-23978046">+91-11-23978046</a></span></h6>
                </h2>
              </div>
            </div>
  
  
          </div>
          <div class="col-lg-4">
  
            <div class="card mx-auto" style="width: 18rem; border: 3px solid #1b6ca8">
  
              <div class="card-body">
                <h5 class="card-title" >Helpline E-mail</h5>
                <h6 class="text-center"><span><a href="mailto:ncov2019@gov.in">ncov2019@gov.in</a></span></h6>
                </h2>
              </div>
            </div>
          </div>
  
          <div class="col-lg-4">
  
            <div class="card mx-auto" style="width: 18rem; border: 3px solid #1b6ca8">
  
              <div class="card-body">
                <h5 class="card-title">Toll Free Number</h5>
                <h6 class="text-center"><span>1075</span></h6>
                </h2>
              </div>
            </div>
  
          </div>
        </div>     
    </section>
    <br><br>

    <footer class="site-footer">
      <div class="container ">
        <div class="row">
          <div class="col-xs-6 col-md-3">
            <h6>Quick Links</h6>
            <ul class="footer-links">
              <li><a href="./index.html">Home</a></li>
              <li><a href="https://www.mohfw.gov.in/" target="_blank">Covid-19 India</a></li>
              <li><a href="./index.html">Apply for Vaccine</a></li>
              <li><a href="./index.html">Request A Bed</a></li>
              <li><a href="#help">Helpline</a></li>
            </ul>
          </div>
          <div class="col-sm-12 col-md-6">
              <!-- <h6>About</h6> -->
              <img src="logo-footer.png" alt="" class="logo-footer">      
          </div>
  
          <div class="col-xs-6 col-md-3">
  
          </div>
        </div>
        <hr>
      </div>
      <div class="container">
        <div class="row">
          <div class="col-md-8 col-sm-6 col-xs-12">
            <p class="copyright-text">Copyright &copy; 2021 All Rights Reserved by
          <a href="#">AB</a>.
            </p>
          </div>

          <div class="col-md-4 col-sm-6 col-xs-12">
            <ul class="social-icons">
              <li><a class="facebook" href="#"><i class="fa fa-facebook"></i></a></li>
              <li><a class="twitter" href="#"><i class="fa fa-twitter"></i></a></li>
              <li><a class="dribbble" href="#"><i class="fa fa-dribbble"></i></a></li>
              <li><a class="linkedin" href="#"><i class="fa fa-linkedin"></i></a></li>
            </ul>
          </div>
        </div>
      </div>
    </footer>

</body>

<script>
    
    $("#question-box").hide();
    $.get('/is_logged_in', function(data, status){
        if(data.val){
        }
        else{
            $("#btn1").hide();
        }
    })
    $("#admin-login-div").hide();
    $("#admin-login").click(function(e){
        e.preventDefault();
        $("#admin-login-div").toggle();
    });
    $("#btn1").click(function(e){
        e.preventDefault();
        $("#question-box").toggle();
    });

    $("#add-ques-btn").click(function(e){
        e.preventDefault();
        let em;
        $.get('/user_email', (data, status)=>{
            em = data.user_email;
            console.log(data);
            let email = em;
            console.log(email);
            let question = $("#question").val();
            
            $.post('/add_question', {email, question}, function(data, status){
                console.log(status);
                console.log(data);
                if(status=="success"){
                    alert("Question posted successfully!");
                    document.location.href = './forum.html';
                }
                else{
                    alert("Some error occurred! Please try again.");
                }
            });
        })

    })

    let adminlogin=false;
    $.get('/admin_logged_in', function(data, status){
      if(data.val){
        adminlogin=true;
      }
    })

    $.get('/all_ques', (data, status)=>{
      let ele = $("#que-cards");
      if(status=="success"){
        console.log("here");
        $.each(data, function(index, item){
            console.log("inside");
            let btid = "q_"+String(item.id);
            let txarid = "tx_"+String(item.id);
            ele.append(
                `<li style="margin: 1%; background: lavender; padding: 2%;">
                    <p>Posted By: ${item.posted_by_email}</p>
                    <p>Date: ${item.date}</p>
                    <p>Question: ${item.question}</p>
                    <p>Answer:</p>
                    <textarea id="${txarid}" readonly style="width: -webkit-fill-available;"></textarea><br>
                    <button id="${btid}" onclick="changeAnswer(${btid}, ${txarid});">Edit</button>
                </li>`
            );
            $("#"+txarid).prop('value', item.answer);
            if(adminlogin==false){
              $("#"+btid).hide();
            }

            // WORKKK
        })
      }
    })

    function changeAnswer(btid, txarid){
      if($(btid).prop('value')=='Update'){
        updateAnswerDB(btid, txarid);
      }
      else{
        console.log(btid);
        $(txarid).attr('readOnly', false);
        $(btid).prop('value', "Update");
        $(btid).text("Update");
      }
    }

    function updateAnswerDB(btid, txarid){
      console.log("update answer in DB");
      let ques_id = String($(btid).attr('id'));
      
      ques_id = ques_id.slice(2);
      let answer = $(txarid).prop('value');
      // console.log(answer);

      $.post('/forum/update_admin_ans', {ques_id, answer}, function(data, status){
        console.log(status);
        console.log(data);
        if(status=="success"){
            alert("Answer updated successfully!");
        }
        else{
            alert("Some error occurred! Please try again.");
        }
      });

      $(txarid).attr('readOnly', true);
      $(btid).prop('value', "Edit");
      $(btid).text("Edit");
    }
</script>
</html>